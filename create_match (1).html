{% extends 'base.html' %}

{% block title %}Schedule Match{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-12">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('match.matches') }}">Matches</a></li>
                <li class="breadcrumb-item active" aria-current="page">Schedule New Match</li>
            </ol>
        </nav>
    </div>
</div>

<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header bg-success text-white">
                <h3 class="card-title mb-0">Schedule New Match</h3>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('match.create_match') }}">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="home_team_id" class="form-label">Home Team</label>
                            <select class="form-select" id="home_team_id" name="home_team_id" required>
                                <option value="" selected disabled>Select home team</option>
                                {% for team in teams %}
                                    <option value="{{ team[0] }}">{{ team[1] }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="away_team_id" class="form-label">Away Team</label>
                            <select class="form-select" id="away_team_id" name="away_team_id" required>
                                <option value="" selected disabled>Select away team</option>
                                {% for team in teams %}
                                    <option value="{{ team[0] }}">{{ team[1] }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="match_date" class="form-label">Match Date</label>
                            <input type="date" class="form-control" id="match_date" name="match_date" required>
                        </div>
                        <div class="col-md-6">
                            <label for="match_time" class="form-label">Match Time</label>
                            <input type="time" class="form-control" id="match_time" name="match_time" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="venue_id" class="form-label">Venue</label>
                        <select class="form-select" id="venue_id" name="venue_id" required>
                            <option value="" selected disabled>Select venue</option>
                            {% for venue in venues %}
                                <option value="{{ venue[0] }}">{{ venue[1] }} ({{ venue[2] }})</option>
                            {% endfor %}
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="match_type" class="form-label">Match Type</label>
                        <select class="form-select" id="match_type" name="match_type">
                            <option value="League">League Match</option>
                            <option value="Cup">Cup Match</option>
                            <option value="Friendly">Friendly</option>
                            <option value="Tournament">Tournament</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="notes" class="form-label">Notes (Optional)</label>
                        <textarea class="form-control" id="notes" name="notes" rows="3"></textarea>
                    </div>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" id="notify_teams" name="notify_teams" checked>
                        <label class="form-check-label" for="notify_teams">
                            Notify Teams
                        </label>
                    </div>
                    
                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-success">Schedule Match</button>
                        <a href="{{ url_for('match.matches') }}" class="btn btn-outline-secondary">Cancel</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<script>
    // Prevent selecting the same team for both home and away
    document.getElementById('home_team_id').addEventListener('change', function() {
        const homeTeamId = this.value;
        const awayTeamSelect = document.getElementById('away_team_id');
        
        // Enable all options first
        Array.from(awayTeamSelect.options).forEach(option => {
            option.disabled = false;
        });
        
        // Disable the selected home team in away team dropdown
        if (homeTeamId) {
            const matchingOption = Array.from(awayTeamSelect.options).find(option => option.value === homeTeamId);
            if (matchingOption) {
                matchingOption.disabled = true;
            }
            
            // If currently selected away team is now disabled, reset selection
            if (awayTeamSelect.value === homeTeamId) {
                awayTeamSelect.value = "";
            }
        }
    });
    
    document.getElementById('away_team_id').addEventListener('change', function() {
        const awayTeamId = this.value;
        const homeTeamSelect = document.getElementById('home_team_id');
        
        // Enable all options first
        Array.from(homeTeamSelect.options).forEach(option => {
            option.disabled = false;
        });
        
        // Disable the selected away team in home team dropdown
        if (awayTeamId) {
            const matchingOption = Array.from(homeTeamSelect.options).find(option => option.value === awayTeamId);
            if (matchingOption) {
                matchingOption.disabled = true;
            }
            
            // If currently selected home team is now disabled, reset selection
            if (homeTeamSelect.value === awayTeamId) {
                homeTeamSelect.value = "";
            }
        }
    });
    
    // Set minimum date to today
    const today = new Date().toISOString().split('T')[0];
    document.getElementById('match_date').setAttribute('min', today);
</script>
{% endblock %}
{% endblock %}